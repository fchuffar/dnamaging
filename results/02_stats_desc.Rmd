---
title: "Descriptive Statistics"
author: "Fabien Jossaud, Florent Chuffart"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
---


```{r include=FALSE}
knitr::opts_chunk$set(collapse=TRUE, comment = "#>", fig.width=9, fig.height=6, eval=TRUE, echo=TRUE, results="verbatim")
source("common.R")
```

```{r params}
source("default_params.R")
```


```{r loading_data}
df_filename = paste0("df_", gse, ".rds")
df = mreadRDS(df_filename)  
```

```{r building_indexes}
idx_samples = rownames(df)
markers_start = grep("cg",colnames(df))[1]
idx_clinicals = colnames(df)[1:(markers_start-1)]
idx_cpg = colnames(df)[markers_start:ncol(df)]
```

# Explained variable distribution

```{r}
layout(1, respect=TRUE)
hist(df[[y_key]], prob=TRUE) 
lines(density(df[[y_key]]))
# Norm_Age = shapiro.test(df[[y_key]])
# text(60,0.03, paste0("SW Normality test p-val = ", round(Norm_Age$p.value,5)))
```


# covariates of interest distribution

```{r}
for (cov in covs) {
  layout(matrix(1:3,1), respect=TRUE)
  tmp_tab = table(df[[cov]], useNA="ifany")  
  tmp_col = 1:dim(tmp_tab)
  tmp_x = barplot(tmp_tab, col=tmp_col, ylim=c(0,max(tmp_tab)*1.2), main=cov, las=2)
  text(tmp_x, tmp_tab+max(tmp_tab)*.1, labels=tmp_tab)

  # AfG = stats::aggregate(formula(paste0(y_key,"~",cov)),data=df,mean)
  # bar_AfG = barplot(height = AfG[[y_key]] , names = AfG[[cov]], col=c("pink","blue"), ylim = c(0,100))
  # text(bar_AfG, AfG[[y_key]] + 2, labels = AfG[[y_key]])
  # Age_H = df[[y_key]][which(df[[cov]] == "M")]
  # Age_F = df[[y_key]][which(df[[cov]] == "F")]
  # WTG = wilcox.test(Age_F,Age_H)
  # text(x = 1, y = 80, labels = paste0("Wilcoxon p-val =", WTG$p.value))

  beanplot::beanplot(formula(paste0(y_key,"~",cov)), data=df, method="jitter", log="")
  # text(x = 1.5, y = 110, labels = paste0("Wilcoxon p-val =", WTG$p.value))

  boxplot(formula(paste0(y_key,"~",cov)), data=df, col=adjustcolor(tmp_col, alpha.f=.5))
  # text(x = 1.5, y = 90, labels = paste0("Wilcoxon p-val =", WTG$p.value))  
}
```


# Session Information

```{r, results="verbatim"}
sessionInfo()
```

