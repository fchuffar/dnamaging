---
title: "Descriptive statistics"
author: "Fabien Jossaud, Florent Chuffart"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
---


```{r echo=FALSE}
knitr::opts_chunk$set(collapse=TRUE, comment = "#>", fig.width=9, fig.height=6, eval=TRUE, echo=FALSE, results="hide")
source("../R/functions.R")
```

```{r params}
source("params_default.R")
```


```{r loading_data}
# df_filename = paste0("df_", gse, ".rds")
# df = mreadRDS(df_filename)
df = dnamaging::df_dnamaging
```


```{r building_indexes}
idx_samples = rownames(df)
markers_start = grep("cg",colnames(df))[1]
idx_clinicals = colnames(df)[1:(markers_start-1)]
idx_cpg = colnames(df)[markers_start:ncol(df)]
```

# Explained variable

```{r}
layout(1, respect=TRUE)
hist(df[[y_key]], prob=TRUE, main="", xlab=y_key) 
lines(density(df[[y_key]]))
# Norm_Age = shapiro.test(df[[y_key]])
# text(60,0.03, paste0("SW Normality test p-val = ", round(Norm_Age$p.value,5)))
```


# Covariates

```{r}
layout(matrix(1:2,1), respect=TRUE)
for (cov in covariates) {
  tmp_tab = table(df[[cov]], useNA="ifany")  
  # tmp_col = 1:dim(tmp_tab)
  tmp_col = RColorBrewer::brewer.pal(n=max(3,dim(tmp_tab)), name = "Set1")
  tmp_x = barplot(tmp_tab, col=tmp_col, ylim=c(0,max(tmp_tab)*1.2), main=cov, las=2)
  text(tmp_x, tmp_tab+max(tmp_tab)*.1, labels=tmp_tab)

  f = paste0(y_key,"~",cov)
  beanplot::beanplot(formula(f), data=df, border=tmp_col, col=adjustcolor(c(1,1,1,1), alpha.f=.1), method="jitter", log="", ylab=y_key, xlab="", las=2, main=f)
  boxplot(formula(f), data=df, col=adjustcolor(tmp_col, alpha.f=.5), ylab=y_key, xlab="", las=2, main=f)
  beeswarm::beeswarm(formula(f), data=df, ylab=y_key, xlab="", col=tmp_col, las=2, main=f)  
}
```


# Session Information

```{r, results="verbatim"}
sessionInfo()
```

