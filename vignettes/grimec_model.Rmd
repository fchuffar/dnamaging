---
title: "RF for predictions"
author: "Jossaud Fabien"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
---


```{r params}

if(!exists("nbewasprobes")){
	nbewasprobes = 10000
}
gse = "trainGBMtest"
y_key = "meth_class"

```

```{r ewas creation}

rmarkdown::render('03_ewas.Rmd',output_file=paste0('03_ewas', nbewasprobes,'_',gse,'_',y_key, '.html'))

```

```{r rf}

df = readRDS(paste0("df_r0_ewas", nbewasprobes, "_", gse,".rds"))
markers_start = grep("cg",colnames(df))[1]
idx_cpg = colnames(df)[markers_start:ncol(df)]
x <- df[,idx_cpg]
y <- df[,y_key]
dataset = cbind(x,y)

control <- caret::trainControl(method='repeatedcv', 
	                        number=10, 
	                        repeats=3)
#Metric compare model is Accuracy
metric <- "Accuracy"
set.seed(123)
#Number randomely variable selected is mtry
mtry <- sqrt(ncol(x))
tunegrid <- expand.grid(.mtry=mtry)
rf_default <- caret::train(y~., 
    	                  data=dataset, 
        	              method='rf', 
        	              metric='Accuracy', 
        	              tuneGrid=tunegrid, 
        	              trControl=control)
print(rf_default)
saveRDS(rf_default,paste0("rf_model",nbewasprobes,"_",y_key,".rds"))


```

