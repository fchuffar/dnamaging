---
title: "Sensibility Analysis"
author: "Fabien Jossaud, Florent Chuffart"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
---


```{r echo=FALSE}
knitr::opts_chunk$set(collapse=TRUE, comment = "#>", fig.width=9, fig.height=6, eval=TRUE, echo=FALSE, results="hide")
source("common.R")
source("sa_params.R")
```

```{r}
for (i in 1:17){
  layout(matrix(1:3, 1), respect=TRUE)
  gse = "GSE50660"
  for(gse in c("GSE50660", "GSE40279", "GSE41037")){ 
  results_g = list()  
  for (n in c(100, 200, 300, 350)) {
      for (p in c(100, 200, 300, 500)) {
        results = list()
        for (seed in 1:3) {
          results_seed = readRDS(paste0("results_gse", gse, "n", n, "seed", seed, "p", p,".rds"))
          results[[length(results)+1]] = results_seed
        }
        results_m=c()
        results_sd=c()
        results_m=c(results_m,mean(unlist(lapply(results,"[[",i))))
        results_sd = c(results_sd,sd(unlist(lapply(results,"[[",i))))
        names_res = c("n","p",names(results[[1]])[i], "lo", "up")
        results_tmp = c(n,p,results_m,results_m-results_sd,results_m+results_sd)
        names(results_tmp)= names_res
        results_g[[length(results_g)+1]] = results_tmp
          
      }
  }
  results_g = data.frame(
    n   = unlist(lapply(results_g, "[[", 1)), 
    p   = unlist(lapply(results_g, "[[", 2)), 
    var = unlist(lapply(results_g, "[[", 3)), 
    lo  = unlist(lapply(results_g, "[[", 4)),
    up  = unlist(lapply(results_g, "[[", 5))
  )
  
  plot(0, 0, col=0, xlab="p", ylab= names_res[3], main=paste0(names_res[3]," en fonction de n et p pour ",gse), xlim=range(results_g$p), ylim=c(0, max(results_g$up)))
  ns = unique(results_g$n)
  foo = lapply(ns, function(n) { 
    results = results_g[results_g$n==n,]
    tmp_col = which(n==ns)
    lines(results$p, results$var, col=tmp_col, lty=1, type = "b")
    arrows(x0=results$p, y0=results$lo, x1=results$p, y1=results$up, code=3, angle=90, length = 0.03, col=tmp_col, lwd=2)
  })
  legend(x="topleft", legend=ns, fill=1:length(ns), title="n")
  
  }
}
```